# 分布式

## 问题

- CAP 理论
- 什么是网络分区
- 为什么CAP不是所谓的“3 选 2”
- 常见的注册中心组件都怎么支持CAP的
- BASE 理论



## 答案

### CAP 理论

!!! tip "CAP 理论"

    - Consistency（一致性）:所有节点访问同一份最新的数据副本
    - Availability（可用性）:非故障的节点在合理的时间内返回合理的响应
    - Partition Tolerance（分区容错性）: 分布式系统出现网络分区的时候，仍然能够对外提供服务

### 什么是网络分区

!!! tip "什么是网络分区"

    分布式系统中，多个节点之前的网络本来是连通的，但是因为某些故障（比如部分节点网络出了问题）某些节点之间不连通了，整个网络就分成了几块区域，这就叫 网络分区。
    
### 为什么CAP不是所谓的“3 选 2”

!!! tip "为什么CAP不是所谓的“3 选 2”"

    理论上不可能选择 CA 架构，只能选择 CP 或者 AP 架构。
    
    除非保证P，分区正常，才能保证CA
    
    如果系统出现分区，某个节点正在写，保证C，就得禁止其它节点读写，这就和A冲突
    
    如果保证A，其它节点正常读写，就不能保证C
    

### 常见的注册中心组件都怎么支持CAP的

!!! tip "常见的注册中心组件都怎么支持CAP的"

    - ZooKeeper 保证的是 CP
    - Eureka 保证的则是 AP
    - Nacos 不仅支持 CP 也支持 AP



### BASE 理论

!!! tip "BASE 理论"

    - Basically Available（基本可用）：损失部分可用性，耗时长点，非核心的不可用（可接受）
    - Soft-state（软状态）：允许数据同步存在延迟
    - Eventually Consistent（最终一致性）：不必实时一致，只要最终一致
    
    做不到强一致性，尽可能做最终一致性
    